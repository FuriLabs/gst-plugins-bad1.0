<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>level: GStreamer Good Plugins 1.0 Plugins Reference Manual</title>
<meta name="generator" content="DocBook XSL Stylesheets Vsnapshot">
<link rel="home" href="index.html" title="GStreamer Good Plugins 1.0 Plugins Reference Manual">
<link rel="up" href="ch01.html" title="gst-plugins-good Elements">
<link rel="prev" href="gst-plugins-good-plugins-lamemp3enc.html" title="lamemp3enc">
<link rel="next" href="gst-plugins-good-plugins-matroskademux.html" title="matroskademux">
<meta name="generator" content="GTK-Doc V1.33.0 (XML mode)">
<link rel="stylesheet" href="style.css" type="text/css">
</head>
<body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF">
<table class="navigation" id="top" width="100%" summary="Navigation header" cellpadding="2" cellspacing="5"><tr valign="middle">
<td width="100%" align="left" class="shortcuts">
<a href="#" class="shortcut">Top</a><span id="nav_description">  <span class="dim">|</span> 
                  <a href="#gst-plugins-good-plugins-level.description" class="shortcut">Description</a></span><span id="nav_hierarchy">  <span class="dim">|</span> 
                  <a href="#gst-plugins-good-plugins-level.object-hierarchy" class="shortcut">Object Hierarchy</a></span><span id="nav_properties">  <span class="dim">|</span> 
                  <a href="#gst-plugins-good-plugins-level.properties" class="shortcut">Properties</a></span>
</td>
<td><a accesskey="h" href="index.html"><img src="home.png" width="16" height="16" border="0" alt="Home"></a></td>
<td><a accesskey="u" href="ch01.html"><img src="up.png" width="16" height="16" border="0" alt="Up"></a></td>
<td><a accesskey="p" href="gst-plugins-good-plugins-lamemp3enc.html"><img src="left.png" width="16" height="16" border="0" alt="Prev"></a></td>
<td><a accesskey="n" href="gst-plugins-good-plugins-matroskademux.html"><img src="right.png" width="16" height="16" border="0" alt="Next"></a></td>
</tr></table>
<div class="refentry">
<a name="gst-plugins-good-plugins-level"></a><div class="titlepage"></div>
<div class="refnamediv"><table width="100%"><tr>
<td valign="top">
<h2><span class="refentrytitle"><a name="gst-plugins-good-plugins-level.top_of_page"></a>level</span></h2>
<p>level</p>
</td>
<td class="gallery_image" valign="top" align="right"></td>
</tr></table></div>
<div class="refsect1">
<a name="gst-plugins-good-plugins-level.properties"></a><h2>Properties</h2>
<div class="informaltable"><table class="informaltable" border="0">
<colgroup>
<col width="150px" class="properties_type">
<col width="300px" class="properties_name">
<col width="200px" class="properties_flags">
</colgroup>
<tbody>
<tr>
<td class="property_type"><a href="/usr/share/gtk-doc/html/glib/glib-Basic-Types.html#guint64"><span class="type">guint64</span></a></td>
<td class="property_name"><a class="link" href="gst-plugins-good-plugins-level.html#GstLevel--interval" title="The “interval” property">interval</a></td>
<td class="property_flags">Read / Write</td>
</tr>
<tr>
<td class="property_type"><a href="/usr/share/gtk-doc/html/glib/glib-Basic-Types.html#gboolean"><span class="type">gboolean</span></a></td>
<td class="property_name"><a class="link" href="gst-plugins-good-plugins-level.html#GstLevel--message" title="The “message” property">message</a></td>
<td class="property_flags">Read / Write</td>
</tr>
<tr>
<td class="property_type"><a href="/usr/share/gtk-doc/html/glib/glib-Basic-Types.html#gdouble"><span class="type">gdouble</span></a></td>
<td class="property_name"><a class="link" href="gst-plugins-good-plugins-level.html#GstLevel--peak-falloff" title="The “peak-falloff” property">peak-falloff</a></td>
<td class="property_flags">Read / Write</td>
</tr>
<tr>
<td class="property_type"><a href="/usr/share/gtk-doc/html/glib/glib-Basic-Types.html#guint64"><span class="type">guint64</span></a></td>
<td class="property_name"><a class="link" href="gst-plugins-good-plugins-level.html#GstLevel--peak-ttl" title="The “peak-ttl” property">peak-ttl</a></td>
<td class="property_flags">Read / Write</td>
</tr>
<tr>
<td class="property_type"><a href="/usr/share/gtk-doc/html/glib/glib-Basic-Types.html#gboolean"><span class="type">gboolean</span></a></td>
<td class="property_name"><a class="link" href="gst-plugins-good-plugins-level.html#GstLevel--post-messages" title="The “post-messages” property">post-messages</a></td>
<td class="property_flags">Read / Write</td>
</tr>
</tbody>
</table></div>
</div>
<a name="GstLevel"></a><div class="refsect1">
<a name="gst-plugins-good-plugins-level.other"></a><h2>Types and Values</h2>
<div class="informaltable"><table class="informaltable" width="100%" border="0">
<colgroup>
<col width="150px" class="other_proto_type">
<col class="other_proto_name">
</colgroup>
<tbody><tr>
<td class="datatype_keyword">struct</td>
<td class="function_name"><a class="link" href="gst-plugins-good-plugins-level.html#GstLevel-struct" title="struct GstLevel">GstLevel</a></td>
</tr></tbody>
</table></div>
</div>
<div class="refsect1">
<a name="gst-plugins-good-plugins-level.object-hierarchy"></a><h2>Object Hierarchy</h2>
<pre class="screen">    <a href="/usr/share/gtk-doc/html/gobject/gobject-The-Base-Object-Type.html#GObject-struct">GObject</a>
    <span class="lineart">╰──</span> <a href="/usr/share/gtk-doc/html/gobject/gobject-The-Base-Object-Type.html#GInitiallyUnowned">GInitiallyUnowned</a>
        <span class="lineart">╰──</span> <a href="/usr/share/gtk-doc/html/gstreamer-1.0/GstObject.html#GstObject-struct">GstObject</a>
            <span class="lineart">╰──</span> <a href="/usr/share/gtk-doc/html/gstreamer-1.0/GstElement.html#GstElement-struct">GstElement</a>
                <span class="lineart">╰──</span> <a href="/usr/share/gtk-doc/html/gstreamer-libs-1.0/GstBaseTransform.html#GstBaseTransform-struct">GstBaseTransform</a>
                    <span class="lineart">╰──</span> GstLevel
</pre>
</div>
<div class="refsect1">
<a name="gst-plugins-good-plugins-level.description"></a><h2>Description</h2>
<p>Level analyses incoming audio buffers and, if the <a class="link" href="gst-plugins-good-plugins-level.html#GstLevel--message" title="The “message” property"><span class="type">“message”</span></a> property
is <a href="/usr/share/gtk-doc/html/glib/glib-Standard-Macros.html#TRUE:CAPS"><code class="literal">TRUE</code></a>, generates an element message named</p>
<code class="classname">"level"</code>:
<p>after each interval of time given by the <a class="link" href="gst-plugins-good-plugins-level.html#GstLevel--interval" title="The “interval” property"><span class="type">“interval”</span></a> property.
The message's structure contains these fields:</p>
<div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; ">
<li class="listitem"><p>
  <a href="/usr/share/gtk-doc/html/gstreamer-1.0/GstClock.html#GstClockTime"><span class="type">GstClockTime</span></a>
  <code class="classname">"timestamp"</code>:
  the timestamp of the buffer that triggered the message.
  </p></li>
<li class="listitem"><p>
  <a href="/usr/share/gtk-doc/html/gstreamer-1.0/GstClock.html#GstClockTime"><span class="type">GstClockTime</span></a>
  <code class="classname">"stream-time"</code>:
  the stream time of the buffer.
  </p></li>
<li class="listitem"><p>
  <a href="/usr/share/gtk-doc/html/gstreamer-1.0/GstClock.html#GstClockTime"><span class="type">GstClockTime</span></a>
  <code class="classname">"running-time"</code>:
  the running_time of the buffer.
  </p></li>
<li class="listitem"><p>
  <a href="/usr/share/gtk-doc/html/gstreamer-1.0/GstClock.html#GstClockTime"><span class="type">GstClockTime</span></a>
  <code class="classname">"duration"</code>:
  the duration of the buffer.
  </p></li>
<li class="listitem"><p>
  <a href="/usr/share/gtk-doc/html/gstreamer-1.0/GstClock.html#GstClockTime"><span class="type">GstClockTime</span></a>
  <code class="classname">"endtime"</code>:
  the end time of the buffer that triggered the message as stream time (this
  is deprecated, as it can be calculated from stream-time + duration)
  </p></li>
<li class="listitem"><p>
  <a href="/usr/share/gtk-doc/html/gobject/gobject-Value-arrays.html#GValueArray-struct"><span class="type">GValueArray</span></a> of <a href="/usr/share/gtk-doc/html/glib/glib-Basic-Types.html#gdouble"><span class="type">gdouble</span></a>
  <code class="classname">"peak"</code>:
  the peak power level in dB for each channel
  </p></li>
<li class="listitem"><p>
  <a href="/usr/share/gtk-doc/html/gobject/gobject-Value-arrays.html#GValueArray-struct"><span class="type">GValueArray</span></a> of <a href="/usr/share/gtk-doc/html/glib/glib-Basic-Types.html#gdouble"><span class="type">gdouble</span></a>
  <code class="classname">"decay"</code>:
  the decaying peak power level in dB for each channel
  The decaying peak level follows the peak level, but starts dropping if no
  new peak is reached after the time given by the <a class="link" href="gst-plugins-good-plugins-level.html#GstLevel--peak-ttl" title="The “peak-ttl” property"><span class="type">“peak-ttl”</span></a>.
  When the decaying peak level drops, it does so at the decay rate as
  specified by the <a class="link" href="gst-plugins-good-plugins-level.html#GstLevel--peak-falloff" title="The “peak-falloff” property"><span class="type">“peak-falloff”</span></a>.
  </p></li>
<li class="listitem"><p>
  <a href="/usr/share/gtk-doc/html/gobject/gobject-Value-arrays.html#GValueArray-struct"><span class="type">GValueArray</span></a> of <a href="/usr/share/gtk-doc/html/glib/glib-Basic-Types.html#gdouble"><span class="type">gdouble</span></a>
  <code class="classname">"rms"</code>:
  the Root Mean Square (or average power) level in dB for each channel
  </p></li>
</ul></div>
<div class="refsect2">
<a name="id-1.2.87.7.6"></a><h3>Example application</h3>
<div class="informalexample">
  <table class="listing_frame" border="0" cellpadding="0" cellspacing="0">
    <tbody>
      <tr>
        <td class="listing_lines" align="right"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140</pre></td>
        <td class="listing_code"><pre class="programlisting"><span class="cm">/* GStreamer</span>
<span class="cm"> * Copyright (C) 2000,2001,2002,2003,2005</span>
<span class="cm"> *           Thomas Vander Stichele &lt;thomas at apestaart dot org&gt;</span>
<span class="cm"> *</span>
<span class="cm"> * This library is free software; you can redistribute it and/or</span>
<span class="cm"> * modify it under the terms of the GNU Library General Public</span>
<span class="cm"> * License as published by the Free Software Foundation; either</span>
<span class="cm"> * version 2 of the License, or (at your option) any later version.</span>
<span class="cm"> *</span>
<span class="cm"> * This library is distributed in the hope that it will be useful,</span>
<span class="cm"> * but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span class="cm"> * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU</span>
<span class="cm"> * Library General Public License for more details.</span>
<span class="cm"> *</span>
<span class="cm"> * You should have received a copy of the GNU Library General Public</span>
<span class="cm"> * License along with this library; if not, write to the</span>
<span class="cm"> * Free Software Foundation, Inc., 51 Franklin St, Fifth Floor,</span>
<span class="cm"> * Boston, MA 02110-1301, USA.</span>
<span class="cm"> */</span>

<span class="cp">#include</span> <span class="cpf">&lt;string.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;math.h&gt;</span><span class="cp"></span>

<span class="cp">#define GLIB_DISABLE_DEPRECATION_WARNINGS</span>

<span class="cp">#include</span> <span class="cpf">&lt;gst/gst.h&gt;</span><span class="cp"></span>

<span class="k">static</span> <span class="n">gboolean</span>
<span class="n">message_handler</span> <span class="p">(</span><span class="n">GstBus</span> <span class="o">*</span> <span class="n">bus</span><span class="p">,</span> <span class="n">GstMessage</span> <span class="o">*</span> <span class="n">message</span><span class="p">,</span> <span class="n">gpointer</span> <span class="n">data</span><span class="p">)</span>
<span class="p">{</span>

  <span class="k">if</span> <span class="p">(</span><span class="n">message</span><span class="o">-&gt;</span><span class="n">type</span> <span class="o">==</span> <span class="n">GST_MESSAGE_ELEMENT</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">const</span> <span class="n">GstStructure</span> <span class="o">*</span><span class="n">s</span> <span class="o">=</span> <span class="n">gst_message_get_structure</span> <span class="p">(</span><span class="n">message</span><span class="p">);</span>
    <span class="k">const</span> <span class="n">gchar</span> <span class="o">*</span><span class="n">name</span> <span class="o">=</span> <span class="n">gst_structure_get_name</span> <span class="p">(</span><span class="n">s</span><span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">strcmp</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="s">&quot;level&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">gint</span> <span class="n">channels</span><span class="p">;</span>
      <span class="n">GstClockTime</span> <span class="n">endtime</span><span class="p">;</span>
      <span class="n">gdouble</span> <span class="n">rms_dB</span><span class="p">,</span> <span class="n">peak_dB</span><span class="p">,</span> <span class="n">decay_dB</span><span class="p">;</span>
      <span class="n">gdouble</span> <span class="n">rms</span><span class="p">;</span>
      <span class="k">const</span> <span class="n">GValue</span> <span class="o">*</span><span class="n">array_val</span><span class="p">;</span>
      <span class="k">const</span> <span class="n">GValue</span> <span class="o">*</span><span class="n">value</span><span class="p">;</span>
      <span class="n">GValueArray</span> <span class="o">*</span><span class="n">rms_arr</span><span class="p">,</span> <span class="o">*</span><span class="n">peak_arr</span><span class="p">,</span> <span class="o">*</span><span class="n">decay_arr</span><span class="p">;</span>
      <span class="n">gint</span> <span class="n">i</span><span class="p">;</span>

      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">gst_structure_get_clock_time</span> <span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="s">&quot;endtime&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">endtime</span><span class="p">))</span>
        <span class="n">g_warning</span> <span class="p">(</span><span class="s">&quot;Could not parse endtime&quot;</span><span class="p">);</span>

      <span class="cm">/* the values are packed into GValueArrays with the value per channel */</span>
      <span class="n">array_val</span> <span class="o">=</span> <span class="n">gst_structure_get_value</span> <span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="s">&quot;rms&quot;</span><span class="p">);</span>
      <span class="n">rms_arr</span> <span class="o">=</span> <span class="p">(</span><span class="n">GValueArray</span> <span class="o">*</span><span class="p">)</span> <span class="n">g_value_get_boxed</span> <span class="p">(</span><span class="n">array_val</span><span class="p">);</span>

      <span class="n">array_val</span> <span class="o">=</span> <span class="n">gst_structure_get_value</span> <span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="s">&quot;peak&quot;</span><span class="p">);</span>
      <span class="n">peak_arr</span> <span class="o">=</span> <span class="p">(</span><span class="n">GValueArray</span> <span class="o">*</span><span class="p">)</span> <span class="n">g_value_get_boxed</span> <span class="p">(</span><span class="n">array_val</span><span class="p">);</span>

      <span class="n">array_val</span> <span class="o">=</span> <span class="n">gst_structure_get_value</span> <span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="s">&quot;decay&quot;</span><span class="p">);</span>
      <span class="n">decay_arr</span> <span class="o">=</span> <span class="p">(</span><span class="n">GValueArray</span> <span class="o">*</span><span class="p">)</span> <span class="n">g_value_get_boxed</span> <span class="p">(</span><span class="n">array_val</span><span class="p">);</span>

      <span class="cm">/* we can get the number of channels as the length of any of the value</span>
<span class="cm">       * arrays */</span>
      <span class="n">channels</span> <span class="o">=</span> <span class="n">rms_arr</span><span class="o">-&gt;</span><span class="n">n_values</span><span class="p">;</span>
      <span class="n">g_print</span> <span class="p">(</span><span class="s">&quot;endtime: %&quot;</span> <span class="n">GST_TIME_FORMAT</span> <span class="s">&quot;, channels: %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
          <span class="n">GST_TIME_ARGS</span> <span class="p">(</span><span class="n">endtime</span><span class="p">),</span> <span class="n">channels</span><span class="p">);</span>
      <span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">channels</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>

        <span class="n">g_print</span> <span class="p">(</span><span class="s">&quot;channel %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">i</span><span class="p">);</span>
        <span class="n">value</span> <span class="o">=</span> <span class="n">g_value_array_get_nth</span> <span class="p">(</span><span class="n">rms_arr</span><span class="p">,</span> <span class="n">i</span><span class="p">);</span>
        <span class="n">rms_dB</span> <span class="o">=</span> <span class="n">g_value_get_double</span> <span class="p">(</span><span class="n">value</span><span class="p">);</span>

        <span class="n">value</span> <span class="o">=</span> <span class="n">g_value_array_get_nth</span> <span class="p">(</span><span class="n">peak_arr</span><span class="p">,</span> <span class="n">i</span><span class="p">);</span>
        <span class="n">peak_dB</span> <span class="o">=</span> <span class="n">g_value_get_double</span> <span class="p">(</span><span class="n">value</span><span class="p">);</span>

        <span class="n">value</span> <span class="o">=</span> <span class="n">g_value_array_get_nth</span> <span class="p">(</span><span class="n">decay_arr</span><span class="p">,</span> <span class="n">i</span><span class="p">);</span>
        <span class="n">decay_dB</span> <span class="o">=</span> <span class="n">g_value_get_double</span> <span class="p">(</span><span class="n">value</span><span class="p">);</span>
        <span class="n">g_print</span> <span class="p">(</span><span class="s">&quot;    RMS: %f dB, peak: %f dB, decay: %f dB</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
            <span class="n">rms_dB</span><span class="p">,</span> <span class="n">peak_dB</span><span class="p">,</span> <span class="n">decay_dB</span><span class="p">);</span>

        <span class="cm">/* converting from dB to normal gives us a value between 0.0 and 1.0 */</span>
        <span class="n">rms</span> <span class="o">=</span> <span class="n">pow</span> <span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="n">rms_dB</span> <span class="o">/</span> <span class="mi">20</span><span class="p">);</span>
        <span class="n">g_print</span> <span class="p">(</span><span class="s">&quot;    normalized rms value: %f</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">rms</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="cm">/* we handled the message we want, and ignored the ones we didn&#39;t want.</span>
<span class="cm">   * so the core can unref the message for us */</span>
  <span class="k">return</span> <span class="n">TRUE</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">int</span>
<span class="n">main</span> <span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="n">argv</span><span class="p">[])</span>
<span class="p">{</span>
  <span class="n">GstElement</span> <span class="o">*</span><span class="n">audiotestsrc</span><span class="p">,</span> <span class="o">*</span><span class="n">audioconvert</span><span class="p">,</span> <span class="o">*</span><span class="n">level</span><span class="p">,</span> <span class="o">*</span><span class="n">fakesink</span><span class="p">;</span>
  <span class="n">GstElement</span> <span class="o">*</span><span class="n">pipeline</span><span class="p">;</span>
  <span class="n">GstCaps</span> <span class="o">*</span><span class="n">caps</span><span class="p">;</span>
  <span class="n">GstBus</span> <span class="o">*</span><span class="n">bus</span><span class="p">;</span>
  <span class="n">guint</span> <span class="n">watch_id</span><span class="p">;</span>
  <span class="n">GMainLoop</span> <span class="o">*</span><span class="n">loop</span><span class="p">;</span>

  <span class="n">gst_init</span> <span class="p">(</span><span class="o">&amp;</span><span class="n">argc</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">argv</span><span class="p">);</span>

  <span class="n">caps</span> <span class="o">=</span> <span class="n">gst_caps_from_string</span> <span class="p">(</span><span class="s">&quot;audio/x-raw,channels=2&quot;</span><span class="p">);</span>

  <span class="n">pipeline</span> <span class="o">=</span> <span class="n">gst_pipeline_new</span> <span class="p">(</span><span class="nb">NULL</span><span class="p">);</span>
  <span class="n">g_assert</span> <span class="p">(</span><span class="n">pipeline</span><span class="p">);</span>
  <span class="n">audiotestsrc</span> <span class="o">=</span> <span class="n">gst_element_factory_make</span> <span class="p">(</span><span class="s">&quot;audiotestsrc&quot;</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
  <span class="n">g_assert</span> <span class="p">(</span><span class="n">audiotestsrc</span><span class="p">);</span>
  <span class="n">audioconvert</span> <span class="o">=</span> <span class="n">gst_element_factory_make</span> <span class="p">(</span><span class="s">&quot;audioconvert&quot;</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
  <span class="n">g_assert</span> <span class="p">(</span><span class="n">audioconvert</span><span class="p">);</span>
  <span class="n">level</span> <span class="o">=</span> <span class="n">gst_element_factory_make</span> <span class="p">(</span><span class="s">&quot;level&quot;</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
  <span class="n">g_assert</span> <span class="p">(</span><span class="n">level</span><span class="p">);</span>
  <span class="n">fakesink</span> <span class="o">=</span> <span class="n">gst_element_factory_make</span> <span class="p">(</span><span class="s">&quot;fakesink&quot;</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
  <span class="n">g_assert</span> <span class="p">(</span><span class="n">fakesink</span><span class="p">);</span>

  <span class="n">gst_bin_add_many</span> <span class="p">(</span><span class="n">GST_BIN</span> <span class="p">(</span><span class="n">pipeline</span><span class="p">),</span> <span class="n">audiotestsrc</span><span class="p">,</span> <span class="n">audioconvert</span><span class="p">,</span> <span class="n">level</span><span class="p">,</span>
      <span class="n">fakesink</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">gst_element_link</span> <span class="p">(</span><span class="n">audiotestsrc</span><span class="p">,</span> <span class="n">audioconvert</span><span class="p">))</span>
    <span class="n">g_error</span> <span class="p">(</span><span class="s">&quot;Failed to link audiotestsrc and audioconvert&quot;</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">gst_element_link_filtered</span> <span class="p">(</span><span class="n">audioconvert</span><span class="p">,</span> <span class="n">level</span><span class="p">,</span> <span class="n">caps</span><span class="p">))</span>
    <span class="n">g_error</span> <span class="p">(</span><span class="s">&quot;Failed to link audioconvert and level&quot;</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">gst_element_link</span> <span class="p">(</span><span class="n">level</span><span class="p">,</span> <span class="n">fakesink</span><span class="p">))</span>
    <span class="n">g_error</span> <span class="p">(</span><span class="s">&quot;Failed to link level and fakesink&quot;</span><span class="p">);</span>

  <span class="cm">/* make sure we&#39;ll get messages */</span>
  <span class="n">g_object_set</span> <span class="p">(</span><span class="n">G_OBJECT</span> <span class="p">(</span><span class="n">level</span><span class="p">),</span> <span class="s">&quot;post-messages&quot;</span><span class="p">,</span> <span class="n">TRUE</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
  <span class="cm">/* run synced and not as fast as we can */</span>
  <span class="n">g_object_set</span> <span class="p">(</span><span class="n">G_OBJECT</span> <span class="p">(</span><span class="n">fakesink</span><span class="p">),</span> <span class="s">&quot;sync&quot;</span><span class="p">,</span> <span class="n">TRUE</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>

  <span class="n">bus</span> <span class="o">=</span> <span class="n">gst_element_get_bus</span> <span class="p">(</span><span class="n">pipeline</span><span class="p">);</span>
  <span class="n">watch_id</span> <span class="o">=</span> <span class="n">gst_bus_add_watch</span> <span class="p">(</span><span class="n">bus</span><span class="p">,</span> <span class="n">message_handler</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>

  <span class="n">gst_element_set_state</span> <span class="p">(</span><span class="n">pipeline</span><span class="p">,</span> <span class="n">GST_STATE_PLAYING</span><span class="p">);</span>

  <span class="cm">/* we need to run a GLib main loop to get the messages */</span>
  <span class="n">loop</span> <span class="o">=</span> <span class="n">g_main_loop_new</span> <span class="p">(</span><span class="nb">NULL</span><span class="p">,</span> <span class="n">FALSE</span><span class="p">);</span>
  <span class="n">g_main_loop_run</span> <span class="p">(</span><span class="n">loop</span><span class="p">);</span>

  <span class="n">g_source_remove</span> <span class="p">(</span><span class="n">watch_id</span><span class="p">);</span>
  <span class="n">g_main_loop_unref</span> <span class="p">(</span><span class="n">loop</span><span class="p">);</span>
  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span></pre></td>
      </tr>
    </tbody>
  </table>
</div>

</div>
<div class="refsynopsisdiv">
<h2>Synopsis</h2>
<div class="refsect2">
<a name="id-1.2.87.7.7.1"></a><h3>Element Information</h3>
<div class="variablelist"><table border="0" class="variablelist">
<colgroup>
<col align="left" valign="top">
<col>
</colgroup>
<tbody>
<tr>
<td><p><span class="term">plugin</span></p></td>
<td>
            <a class="link" href="gst-plugins-good-plugins-plugin-level.html#plugin-level">level</a>
          </td>
</tr>
<tr>
<td><p><span class="term">author</span></p></td>
<td>Thomas Vander Stichele &lt;thomas at apestaart dot org&gt;</td>
</tr>
<tr>
<td><p><span class="term">class</span></p></td>
<td>Filter/Analyzer/Audio</td>
</tr>
</tbody>
</table></div>
</div>
<hr>
<div class="refsect2">
<a name="id-1.2.87.7.7.2"></a><h3>Element Pads</h3>
<div class="variablelist"><table border="0" class="variablelist">
<colgroup>
<col align="left" valign="top">
<col>
</colgroup>
<tbody>
<tr>
<td><p><span class="term">name</span></p></td>
<td>sink</td>
</tr>
<tr>
<td><p><span class="term">direction</span></p></td>
<td>sink</td>
</tr>
<tr>
<td><p><span class="term">presence</span></p></td>
<td>always</td>
</tr>
<tr>
<td><p><span class="term">details</span></p></td>
<td>audio/x-raw, format=(string){ S8, S16LE, S32LE, F32LE, F64LE }, layout=(string)interleaved, rate=(int)[ 1, 2147483647 ], channels=(int)[ 1, 2147483647 ]</td>
</tr>
</tbody>
</table></div>
<div class="variablelist"><table border="0" class="variablelist">
<colgroup>
<col align="left" valign="top">
<col>
</colgroup>
<tbody>
<tr>
<td><p><span class="term">name</span></p></td>
<td>src</td>
</tr>
<tr>
<td><p><span class="term">direction</span></p></td>
<td>source</td>
</tr>
<tr>
<td><p><span class="term">presence</span></p></td>
<td>always</td>
</tr>
<tr>
<td><p><span class="term">details</span></p></td>
<td>audio/x-raw, format=(string){ S8, S16LE, S32LE, F32LE, F64LE }, layout=(string)interleaved, rate=(int)[ 1, 2147483647 ], channels=(int)[ 1, 2147483647 ]</td>
</tr>
</tbody>
</table></div>
</div>
</div>
</div>
<div class="refsect1">
<a name="gst-plugins-good-plugins-level.functions_details"></a><h2>Functions</h2>
<p></p>
</div>
<div class="refsect1">
<a name="gst-plugins-good-plugins-level.other_details"></a><h2>Types and Values</h2>
<div class="refsect2">
<a name="GstLevel-struct"></a><h3>struct GstLevel</h3>
<pre class="programlisting">struct GstLevel;</pre>
<p>Opaque data structure.</p>
</div>
</div>
<div class="refsect1">
<a name="gst-plugins-good-plugins-level.property-details"></a><h2>Property Details</h2>
<div class="refsect2">
<a name="GstLevel--interval"></a><h3>The <code class="literal">“interval”</code> property</h3>
<pre class="programlisting">  “interval”                 <a href="/usr/share/gtk-doc/html/glib/glib-Basic-Types.html#guint64"><span class="type">guint64</span></a></pre>
<p>Interval of time between message posts (in nanoseconds).</p>
<p>Owner: GstLevel</p>
<p>Flags: Read / Write</p>
<p>Allowed values: &gt;= 1</p>
<p>Default value: 100000000</p>
</div>
<hr>
<div class="refsect2">
<a name="GstLevel--message"></a><h3>The <code class="literal">“message”</code> property</h3>
<pre class="programlisting">  “message”                  <a href="/usr/share/gtk-doc/html/glib/glib-Basic-Types.html#gboolean"><span class="type">gboolean</span></a></pre>
<p>Post a 'level' message for each passed interval (deprecated, use the post-messages property instead).</p>
<p>Owner: GstLevel</p>
<p>Flags: Read / Write</p>
<p>Default value: TRUE</p>
</div>
<hr>
<div class="refsect2">
<a name="GstLevel--peak-falloff"></a><h3>The <code class="literal">“peak-falloff”</code> property</h3>
<pre class="programlisting">  “peak-falloff”             <a href="/usr/share/gtk-doc/html/glib/glib-Basic-Types.html#gdouble"><span class="type">gdouble</span></a></pre>
<p>Decay rate of decay peak after TTL (in dB/sec).</p>
<p>Owner: GstLevel</p>
<p>Flags: Read / Write</p>
<p>Allowed values: &gt;= 0</p>
<p>Default value: 10</p>
</div>
<hr>
<div class="refsect2">
<a name="GstLevel--peak-ttl"></a><h3>The <code class="literal">“peak-ttl”</code> property</h3>
<pre class="programlisting">  “peak-ttl”                 <a href="/usr/share/gtk-doc/html/glib/glib-Basic-Types.html#guint64"><span class="type">guint64</span></a></pre>
<p>Time To Live of decay peak before it falls back (in nanoseconds).</p>
<p>Owner: GstLevel</p>
<p>Flags: Read / Write</p>
<p>Default value: 300000000</p>
</div>
<hr>
<div class="refsect2">
<a name="GstLevel--post-messages"></a><h3>The <code class="literal">“post-messages”</code> property</h3>
<pre class="programlisting">  “post-messages”            <a href="/usr/share/gtk-doc/html/glib/glib-Basic-Types.html#gboolean"><span class="type">gboolean</span></a></pre>
<p>Post messages on the bus with level information.</p>
<div class="warning">
<p><code class="literal">GstLevel:post-messages</code> is deprecated and should not be used in newly-written code.</p>
<p>use the <a class="link" href="gst-plugins-good-plugins-level.html#GstLevel--post-messages" title="The “post-messages” property"><span class="type">“post-messages”</span></a> property</p>
</div>
<p>Owner: GstLevel</p>
<p>Flags: Read / Write</p>
<p>Default value: TRUE</p>
<p class="since">Since: 1.1.0</p>
</div>
</div>
</div>
<div class="footer">
<hr>Generated by GTK-Doc V1.33.0</div>
</body>
</html>